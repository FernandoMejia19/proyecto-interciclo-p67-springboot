<div class="container_perfil-usuario" *ngIf="perfil; else cargando">
  
  <!-- PORTADA -->
  <div class="portada-usuario">
    <div class="overlay"></div>

    <!-- FOTO DE PERFIL -->
    <img 
      class="imagen-usuario"
      [src]="perfil.photoURL || 'https://lienzocreativo.com/blog/wp-content/uploads/2020/03/primer-plano.jpg'" 
      alt="Foto de perfil">

    <div class="encabezado-usuario">
      <h2>{{ perfil.nombre || 'Usuario' }}</h2>
      <p>{{ perfil.descripcion || 'Sin descripción' }}</p>
    </div>
  </div>

  <div class="container-contenido">

    <!-- INFORMACIÓN PERSONAL -->
    <div class="informacion-usuario card-info">
      <h3 class="titulo-seccion">Información Personal</h3>

      <p><strong>Email:</strong> {{ perfil.email }}</p>
      <p><strong>Ciudad:</strong> {{ perfil.ciudad || 'No especificada' }}</p>
      <p><strong>País:</strong> {{ perfil.pais || 'No especificado' }}</p>

      <!-- CONTACTOS -->
      <div class="redes-sociales" *ngIf="tieneContactos()">
        <h4>Mis Contactos</h4>
        <div *ngIf="perfil.contactos?.whatsapp">
          WhatsApp: 
          <a [href]="'https://wa.me/' + perfil.contactos.whatsapp" target="_blank">
            {{ perfil.contactos.whatsapp }}
          </a>
        </div>
        <div *ngIf="perfil.contactos?.instagram">
          Instagram: 
          <a [href]="'https://www.instagram.com/' + perfil.contactos.instagram" target="_blank">
            {{ perfil.contactos.instagram }}
          </a>
        </div>
        <div *ngIf="perfil.contactos?.facebook">
          Facebook:
          <a [href]="'https://facebook.com/' + perfil.contactos.facebook" target="_blank">
            {{ perfil.contactos.facebook }}
          </a>
        </div>
      </div>

      <div class="acciones-perfil">
        <button class="btn-editar-perfil" (click)="irAEditarPerfil()">
          Editar Información Personal
        </button>
      </div>
    </div>

    <div class="contenido-dinamico">

      <!-- SI ES USUARIO NORMAL -->
      <div *ngIf="perfil.role === 'user'" class="seccion-user card-info">
        <h3 class="titulo-seccion">Mis Solicitudes de Asesoría</h3>
        <app-mis-citas [esSolicitante]="true"></app-mis-citas>
      </div>

      <!-- SI ES DEV O ADMIN -->
      <div *ngIf="perfil.role !== 'user'">

        <div class="menu-tabs">
          <button [class.activo]="seccionActiva === 'proyectos'" (click)="cambiarSeccion('proyectos')">
            Mis Proyectos
          </button>
          <button [class.activo]="seccionActiva === 'citas'" (click)="cambiarSeccion('citas')">
            Asesorías Recibidas
          </button>
          <button *ngIf="isAdmin" [class.activo]="seccionActiva === 'usuarios'" (click)="cambiarSeccion('usuarios')">
            Gestionar Usuarios
          </button>
        </div>

        <!-- PROYECTOS -->
        <div *ngIf="seccionActiva === 'proyectos'">
          <button class="btn-crear-full" (click)="crearNuevoProyecto()">Crear Proyecto</button>

          <div class="grid-proyectos">
            <div class="card-proyecto" *ngFor="let pro of proyectos">
              <img [src]="pro.imagen || 'assets/default.png'" class="img-proyecto">

              <div class="info-proyecto">
                <h4>{{ pro.titulo }}</h4>
              </div>

              <div class="acciones-proyecto">
                <button class="btn-editar" (click)="editarProyecto(pro.id)">Editar</button>
                <button class="btn-eliminar" (click)="eliminarProyecto(pro.id)">Eliminar</button>
              </div>
            </div>
          </div>
        </div>

        <!-- ASESORÍAS RECIBIDAS -->
        <div *ngIf="seccionActiva === 'citas'" class="card-info">
          <app-mis-citas [esSolicitante]="false"></app-mis-citas>
        </div>

        <!-- ADMIN -->
        <div *ngIf="seccionActiva === 'usuarios' && isAdmin">
          <app-admin-usuarios></app-admin-usuarios>
        </div>

      </div>

    </div>
  </div>
</div>

<!-- CONFIRMACIÓN -->
<div class="modal-confirm" *ngIf="confirmData.mostrar">
  <div class="modal-box">
    <p>{{ confirmData.mensaje }}</p>
    <div class="acciones">
      <button class="btn-si" (click)="confirmarAccion()">Sí</button>
      <button class="btn-no" (click)="cancelarAccion()">No</button>
    </div>
  </div>
</div>

<!-- NOTIFICACIONES -->
<div class="toast" *ngIf="toast.mostrar" [class.error]="toast.tipo === 'error'">
  {{ toast.mensaje }}
</div>

<ng-template #cargando>
  <div class="loading">Cargando perfil...</div>
</ng-template>
